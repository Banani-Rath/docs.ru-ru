---
title: "Универсальные типы во время выполнения (Руководство по программированию в C#) | Microsoft Docs"
ms.custom: ""
ms.date: "11/24/2016"
ms.prod: "visual-studio-dev14"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "devlang-csharp"
ms.tgt_pltfrm: ""
ms.topic: "article"
dev_langs: 
  - "CSharp"
helpviewer_keywords: 
  - "универсальные шаблоны [C#], во время выполнения"
ms.assetid: 119df7e6-9ceb-49df-af36-24f8f8c0747f
caps.latest.revision: 18
caps.handback.revision: 18
author: "BillWagner"
ms.author: "wiwagn"
manager: "wpickett"
translationtype: Human Translation
---
# Универсальные типы во время выполнения (Руководство по программированию в C#)
[!INCLUDE[vs2017banner](../../../csharp/includes/vs2017banner.md)]

При компиляции универсального типа или метода в код MSIL \(Microsoft intermediate language — промежуточный язык Майкрософт\), он содержит метаданные, указывающие, что он имеет параметры типа.  Использование кода MSIL для универсального типа зависит от того, какой тип имеет поставляемый параметр типа — тип значения или ссылочный тип.  
  
 При первом построении универсального типа с типом значения в качестве параметра среда выполнения создает специализированный универсальный тип с поставляемым параметром или параметрами, которые замещаются в соответствующих местах кода MSIL.  Специализированные универсальные типы создаются один раз для каждого уникального типа значения, который используется в качестве параметра.  
  
 Например, предположим, что в коде программы объявлен стек, построенный из целых чисел:  
  
 [!CODE [csProgGuideGenerics#42](../CodeSnippet/VS_Snippets_VBCSharp/csProgGuideGenerics#42)]  
  
 В этой точке среда выполнения генерирует специализированную версию класса <xref:System.Collections.Generic.Stack%601>, в котором целое число соответствующим образом замещается на его параметр.  Затем каждый раз, когда в коде программы используется стек целых чисел, среда выполнения снова использует сгенерированный специализированный класс <xref:System.Collections.Generic.Stack%601>.  В следующем примере создаются два экземпляра стека целых чисел, которые совместно используют один экземпляр кода `Stack<int>`.  
  
 [!CODE [csProgGuideGenerics#43](../CodeSnippet/VS_Snippets_VBCSharp/csProgGuideGenerics#43)]  
  
 Однако допустим, что в другой точке кода создается другой класс <xref:System.Collections.Generic.Stack%601> с другим типом значения, например `long`, или с определенной пользователем структурой в качестве параметра.  В результате среда выполнения генерирует другую версию универсального типа и замещает тип `long` в соответствующих местах кода MSIL.  Дальнейшие преобразования не требуются, потому что каждый специализированный универсальный тип содержит встроенный тип значения.  
  
 Действие универсальных типов несколько отличается от ссылочных типов.  При первом создании универсального типа с каким\-либо ссылочным типом среда выполнения создает специализированный универсальный тип, в котором ссылки на объекты замещены параметрами в коде MSIL.  Затем при каждом создании экземпляра построенного типа со ссылочным типом в качестве параметра, \(независимо от того, какой это тип\) среда выполнения снова использует созданную ранее специализированную версию универсального типа.  Это возможно, потому что все ссылки имеют одинаковый размер.  
  
 Например, допустим, что существует два ссылочных типа, класс `Customer` и класс `Order`, а также допустим, что создан стек типов `Customer`.  
  
 [!CODE [csProgGuideGenerics#47](../CodeSnippet/VS_Snippets_VBCSharp/csProgGuideGenerics#47)]  
  
 [!CODE [csProgGuideGenerics#44](../CodeSnippet/VS_Snippets_VBCSharp/csProgGuideGenerics#44)]  
  
 В этой точке среда выполнения генерирует специализированную версию класса <xref:System.Collections.Generic.Stack%601>, в котором сохраняются ссылки на объекты, которые будут заполнены позже, а не данные.  Допустим, что в следующей строке кода создается стек другого ссылочного типа с именем `Order`.  
  
 [!CODE [csProgGuideGenerics#45](../CodeSnippet/VS_Snippets_VBCSharp/csProgGuideGenerics#45)]  
  
 В отличие о типов значений, другая специализированная версия класса <xref:System.Collections.Generic.Stack%601> для типа `Order` не создается.  Вместо этого создается экземпляр специализированной версии класса <xref:System.Collections.Generic.Stack%601>, а также задается переменная `orders` для ссылки на этот класс.  Допустим, что затем встречается строка кода, в которой создается стек типа `Customer`:  
  
 [!CODE [csProgGuideGenerics#46](../CodeSnippet/VS_Snippets_VBCSharp/csProgGuideGenerics#46)]  
  
 Как и в предыдущем случае использования класса <xref:System.Collections.Generic.Stack%601>, созданного с помощью типа `Order`, создается новый экземпляр специализированного класса <xref:System.Collections.Generic.Stack%601>.  Содержащиеся в нем указатели ссылаются на область памяти, имеющую размер типа `Customer`.  Так как количество ссылочных типов в разных программах может существенно отличаться, реализация универсальных типов в языке C\# значительно сокращает объем кода путем сокращения количества специализированных классов, создаваемых компилятором для универсальных классов ссылочного типа, до одного.  
  
 Более того, при создании экземпляра универсального класса в языке C\# с помощью типа значения или параметра ссылочного типа, отражение может обращаться к нему с запросами во время выполнения, а также возможно установить его фактический тип и параметр типа.  
  
## См. также  
 <xref:System.Collections.Generic>   
 [Руководство по программированию на C\#](../../../csharp/programming-guide/index.md)   
 [Введение в универсальные шаблоны](../../../csharp/programming-guide/generics/introduction-to-generics.md)   
 [Универсальные шаблоны](../Topic/Generics%20in%20the%20.NET%20Framework.md)